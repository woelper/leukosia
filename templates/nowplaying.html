{% extends "master.html" %}
{%block content%}
    <div class="container-fluid">

		<div class="row-fluid">
		
			<div class="content content-left span9">
				
				<div class="tabbable">
					<ul class="nav nav-tabs">
					  <li class="active"><a href="#tab1" data-toggle="tab">Now Playing</a></li>
					  <li><a href="#tab2" data-toggle="tab">Artistinfo</a></li>
					  <li><a href="#tab3" data-toggle="tab">Play Queue</a></li>
					  <li><a href="#tab4" data-toggle="tab">Playlists</a></li>
					  <li><a href="#tab5" data-toggle="tab">Now Playing</a></li>
					  <li><a href="#tab6" data-toggle="tab">Now Playing</a></li>
					</ul>
					
					<div class="tab-content">
						<div class="tab-pane active" id="tab1">
							<div id="albumcovercontainer" class="pull-left">
								<img src="{{STATIC_URL}}img/loading.gif" />
							</div>
							<div id="trackinfo" style="display:none" class="pull-left">
								<!-- trackinfo created by ajax call -->
							</div>
						</div>
						
						<div class="tab-pane" id="tab2">
							<div id="artistinfo">
							</div>
						</div>
						
						<div class="tab-pane" id="tab3">
							<table class="table table-condensed table-striped">
								<thead>
									<tr>			
									<th>Track</th>
									<th>Title</th>
									<th>Artist</th>
									<th>Album</th>
									<th>Date</th>
									<th>Genre</th>
									<th>Duration</th>		
								</tr>		
								</thead>
								<tbody>
								{% for e in playlist%}
								<tr>
									<td>{{e.track}}</td>
									<td>{{e.title}}</td>
									<td>{{e.artist}}</td>
									<td>{{e.album}}</td>
									<td>{{e.date}}</td>
									<td>{{e.genre}}</td>
									<td>{{e.time}}</td>
								</tr>
								{% endfor %}
								</tbody>
							</table>
							
						</div>
					</div>
				</div>
				
			</div> <!-- /content --> 

		
		

    

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript">
	var html = "";
	var last_artist = "";
	var last_album = "";
	var cur_artist;
	var cur_album;
	
	function get_lastfm_albuminfo(artist,album) {
		
		$.ajax({
			type: "POST",
			url:  '/lastfmalbuminfo/',
			dataType: "json",
			data : {'album': album, 'artist': artist},
			success: function(data, textStatus, XMLHttpRequest) {
				$('#albumcovercontainer').html('<img id="albumcover" class="img-polaroid" src="'+
					data.albumcoverurl+'" style="border:1px solid #F8F8F8;">');		
			}
		});
		
	}
	
	function get_lastfm_artistinfo(artist) {
		
		$.ajax({
			type: "POST",
			url:  '/lastfmartistinfo/',
			dataType: "json",
			data : {'artist': artist},
			success: function(data, textStatus, XMLHttpRequest) {
				$('#artistinfo').html('<div id="artistimagediv">'+
				'<img id="artistimage" class="img-rounded pull-left" src="'+data.artistimageurl+
				'" style="border:1px solid #F8F8F8;">'+
				'</div>'+data.artistbio);
			}
		});
		
	}
	
	function update_nowplaying() {
	
		$.ajax({
			type: "POST",
			url:  '/nowplaying/?station_port={{station_port|safe}}' ,
			dataType: "json",
			success: function(data, textStatus, XMLHttpRequest) {
				cur_artist = data.artist;
				cur_album = data.album;
				html = "<b>" + data.title + "</b><br><br>" +
					"<b>" + data.artist + "</b><br>" +
					data.album + " (" + data.date + ")<br><br>" +
					"<span style='font-size:80%'>" +
					"Genre: " + data.genre + "<br>" +
					"Track: "+ data.track + "<br>" +
					"Length: " + data.time + "<br>" +
					"</span>"
				$("#trackinfo").html(html);	
				$('#trackinfo').show();
				
				if (cur_album != last_album) { //if album changes
					$('#albumcovercontainer').html('<img src="{{STATIC_URL}}img/loading.gif" />');
					get_lastfm_albuminfo(cur_artist,cur_album);
				}
				if (last_artist != cur_artist) { //if album changes
					$('#artistinfo').html('<img src="{{STATIC_URL}}img/loading.gif" />');
					get_lastfm_artistinfo(cur_artist);
				}
				last_artist = cur_artist;
				last_album = cur_album 
			}
				
		});
	}
		
	$(document).ready(function () {
		update_nowplaying();
		setInterval(update_nowplaying,5000);
	});
</script>
{% endblock %}
